import{h as w}from"./moment.9709ab41.js";import{_ as p,u as v,r as m,o as c,c as r,a as t,e as g,bu as b,F as $,g as C,b as h,w as S,d as x,t as l,q as T,j as f,n as W,aQ as F,aO as B}from"./index.03186340.js";import{_ as E}from"./boycott.abc0ad59.js";const U={name:"TableWarns",data(){return{warns:[],warnFilter:"all",toast:v()}},async created(){await this.getWarns()},watch:{warnFilter(){this.getWarns()}},methods:{async getWarns(){this.warns=[];try{(await(await fetch("https://boycott-service.onrender.com/api/boycott/warn")).json()).forEach(s=>{let i=w(new Date(s.dateStart)).format("MM-DD-YYYY");s.warns.forEach(a=>{if(this.warnFilter=="pending"&&!a.read||this.warnFilter=="all"){let d={_id:s._id,title:s.title,image:s.image,dateStart:i,user_id:a.userId._id,login:a.userId.login,warn_id:a._id,read:a.read};this.warns.push(d)}})})}catch(n){this.toast.error(n.message)}},async checkWarn(n){try{if((await fetch("https://boycott-service.onrender.com/api/warn?id="+n,{method:"PUT",headers:{"Content-type":"application/json",Authorization:"Bearer "+localStorage.accessToken,"x-access-token":localStorage.accessToken}})).status==401)throw new Error("Error autorisation");this.getWarns()}catch(e){this.toast.error(e.message)}},async deleteWarn(n,e){try{await fetch("https://boycott-service.onrender.com/api/warn?boycottId="+n+"&userId="+e,{method:"DELETE",headers:{"Content-type":"application/json",Authorization:"Bearer "+localStorage.accessToken,"x-access-token":localStorage.accessToken}}),this.getWarns()}catch(s){this.toast.error(s)}}}},u=n=>(F("data-v-f6590b40"),n=n(),B(),n),D={class:"card"},I={class:"card-body"},j={class:"card-title row"},N=u(()=>t("div",{class:"col"},[t("h4",null,"Avertissements")],-1)),V={class:"col-auto form-inline"},A={class:"form-check form-check-inline"},M=u(()=>t("label",{class:"form-check-label",for:"inlineRadio1"},"Tous",-1)),R={class:"form-check form-check-inline"},q=u(()=>t("label",{class:"form-check-label",for:"inlineRadio2"},"Suspens",-1)),Y={class:"table-responsive"},z={class:"table text-center"},L=u(()=>t("thead",null,[t("tr",null,[t("th",null," Boycott image"),t("th",null," Nom du boycott "),t("th",null," Utilisateur "),t("th",null," Date du d\xE9but "),t("th",null," Statut "),t("th"),t("th")])],-1)),O=["src"],P={key:1,src:E,class:"img-fluid",alt:""},Q=["onClick"],G=u(()=>t("i",{class:"bi bi-check"},null,-1)),H=[G],J=["onClick"],K=u(()=>t("i",{class:"bi bi-trash"},null,-1)),X=[K];function Z(n,e,s,i,a,d){const _=m("router-link");return c(),r("div",D,[t("div",I,[t("div",j,[N,t("div",V,[t("div",A,[g(t("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":e[0]||(e[0]=o=>a.warnFilter=o),id:"inlineRadio1",value:"all"},null,512),[[b,a.warnFilter]]),M]),t("div",R,[g(t("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":e[1]||(e[1]=o=>a.warnFilter=o),id:"inlineRadio2",value:"pending"},null,512),[[b,a.warnFilter]]),q])])]),t("div",Y,[t("table",z,[L,t("tbody",null,[(c(!0),r($,null,C(a.warns,(o,y)=>(c(),r("tr",{key:y},[t("td",null,[o.image&&o.image.length>0?(c(),r("img",{key:0,src:"https://images.kalanso.top/"+o.image[0],alt:""},null,8,O)):(c(),r("img",P))]),t("td",null,[h(_,{target:"_blank",to:{name:"boycott",params:{id:o._id}}},{default:S(()=>[x(l(o.title),1)]),_:2},1032,["to"])]),t("td",null,l(o.login),1),t("td",null,l(o.dateStart),1),t("td",null,[t("div",{class:T(["badge",o.read?"badge-outline-success":"badge-outline-danger"])},l(o.read?"Approuv\xE9":"Suspens"),3)]),t("td",null,[o.read?W("",!0):(c(),r("a",{key:0,href:"#",onClick:f(k=>d.checkWarn(o.warn_id),["prevent"])},H,8,Q))]),t("td",null,[t("a",{href:"#",onClick:f(k=>d.deleteWarn(o._id,o.user_id),["prevent"])},X,8,J)])]))),128))])])])])])}const tt=p(U,[["render",Z],["__scopeId","data-v-f6590b40"]]),et={name:"StatCard",props:{icon:String,number:Number,title:String}},st={class:"card"},ot={class:"card-body"},nt={class:"row"},at={class:"col-9"},ct={class:"text-muted font-weight-normal"},rt={class:"d-flex align-items-center align-self-start"},it={class:"mb-0"},lt={class:"col-3"},dt={class:"icon icon-box-success"},_t={class:"material-icons"};function ht(n,e,s,i,a,d){return c(),r("div",st,[t("div",ot,[t("div",nt,[t("div",at,[t("h6",ct,l(s.title),1),t("div",rt,[t("h3",it,l(s.number),1)])]),t("div",lt,[t("div",dt,[t("span",_t,l(s.icon),1)])])])])])}const ut=p(et,[["render",ht]]),mt={name:"MainContent",components:{TableWarns:tt,StatCard:ut},data(){return{countUsers:0,countBoycotts:0,countComments:0,countFollows:0}},async created(){await this.getCounts()},methods:{async getCounts(){const n=v();try{let e=await fetch("https://boycott-service.onrender.com/api/users"),s=await e.json();e.status==200?this.countUsers=s.totalUsers:n.error(s.message),e=await fetch("https://boycott-service.onrender.com/api/boycott/stat"),s=await e.json(),e.status==200?s.length&&s.forEach(i=>{this.countBoycotts++,this.countComments+=i.comment_count,this.countFollows+=i.likes_count}):n.error(s.message)}catch(e){n.error(e.message)}}}},pt={class:"content-wrapper"},gt={class:"row"},bt={class:"col-xl-3 col-sm-6 grid-margin stretch-card"},ft={class:"col-xl-3 col-sm-6 grid-margin stretch-card"},vt={class:"col-xl-3 col-sm-6 grid-margin stretch-card"},yt={class:"col-xl-3 col-sm-6 grid-margin stretch-card"},kt={class:"row"},wt={class:"col-12 grid-margin"};function $t(n,e,s,i,a,d){const _=m("StatCard"),o=m("TableWarns");return c(),r("div",pt,[t("div",gt,[t("div",bt,[h(_,{icon:"manage_accounts",number:a.countUsers,title:"Utilisateurs"},null,8,["number"])]),t("div",ft,[h(_,{icon:"event",number:a.countBoycotts,title:"Boycotts"},null,8,["number"])]),t("div",vt,[h(_,{icon:"chat_bubble",number:a.countComments,title:"Commentaires"},null,8,["number"])]),t("div",yt,[h(_,{icon:"supervisor_account",number:a.countFollows,title:"Abonn\xE9s(\xE9es)"},null,8,["number"])])]),t("div",kt,[t("div",wt,[h(o)])])])}const Tt=p(mt,[["render",$t]]);export{Tt as default};
