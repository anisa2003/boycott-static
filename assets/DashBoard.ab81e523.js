import{h as w}from"./moment.9709ab41.js";import{_ as p,u as f,r as m,o as c,c as i,a as t,e as g,bu as b,F as $,g as C,b as u,w as S,d as x,t as l,q as T,j as v,n as W,aQ as F,aO as B}from"./index.21bf1f37.js";import{_ as E}from"./boycott.abc0ad59.js";const I={name:"TableWarns",data(){return{warns:[],warnFilter:"all",toast:f()}},async created(){await this.getWarns()},watch:{warnFilter(){this.getWarns()}},methods:{async getWarns(){this.warns=[];try{(await(await fetch("https://boycott-service.onrender.com/api/boycott/warn")).json()).forEach(s=>{let r=w(new Date(s.dateStart)).format("MM-DD-YYYY");s.warns.forEach(n=>{if(this.warnFilter=="pending"&&!n.read||this.warnFilter=="all"){let d={_id:s._id,title:s.title,image:s.image,dateStart:r,user_id:n.userId._id,login:n.userId.login,warn_id:n._id,read:n.read};this.warns.push(d)}})})}catch(a){this.toast.error(a.message)}},async checkWarn(a){try{if((await fetch("https://boycott-service.onrender.com/api/warn?id="+a,{method:"PUT",headers:{"Content-type":"application/json",Authorization:"Bearer "+localStorage.accessToken,"x-access-token":localStorage.accessToken}})).status==401)throw new Error("Error autorisation");this.getWarns()}catch(e){this.toast.error(e.message)}},async deleteWarn(a,e){try{await fetch("https://boycott-service.onrender.com/api/warn?boycottId="+a+"&userId="+e,{method:"DELETE",headers:{"Content-type":"application/json",Authorization:"Bearer "+localStorage.accessToken,"x-access-token":localStorage.accessToken}}),this.getWarns()}catch(s){this.toast.error(s)}}}},h=a=>(F("data-v-14113031"),a=a(),B(),a),U={class:"card bg-transparent"},D={class:"card-body"},j={class:"card-title row"},N=h(()=>t("div",{class:"col"},[t("h4",null,"Avertissements")],-1)),V={class:"col-auto form-inline"},A={class:"form-check form-check-inline"},M=h(()=>t("label",{class:"form-check-label",for:"inlineRadio1"},"Tous",-1)),R={class:"form-check form-check-inline"},q=h(()=>t("label",{class:"form-check-label",for:"inlineRadio2"},"Suspens",-1)),Y={class:"table-responsive"},z={class:"table text-center table-dark table-striped rounded-corners"},L=h(()=>t("thead",null,[t("tr",null,[t("th",null," Boycott image"),t("th",null," Nom du boycott "),t("th",null," Utilisateur "),t("th",null," Date du d\xE9but "),t("th",null," Statut "),t("th"),t("th")])],-1)),O=["src"],P={key:1,src:E,class:"img-fluid small-testimonial-img",alt:""},Q=["onClick"],G=h(()=>t("i",{class:"bi bi-check"},null,-1)),H=[G],J=["onClick"],K=h(()=>t("i",{class:"bi bi-trash"},null,-1)),X=[K];function Z(a,e,s,r,n,d){const _=m("router-link");return c(),i("div",U,[t("div",D,[t("div",j,[N,t("div",V,[t("div",A,[g(t("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":e[0]||(e[0]=o=>n.warnFilter=o),id:"inlineRadio1",value:"all"},null,512),[[b,n.warnFilter]]),M]),t("div",R,[g(t("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":e[1]||(e[1]=o=>n.warnFilter=o),id:"inlineRadio2",value:"pending"},null,512),[[b,n.warnFilter]]),q])])]),t("div",Y,[t("table",z,[L,t("tbody",null,[(c(!0),i($,null,C(n.warns,(o,y)=>(c(),i("tr",{key:y},[t("td",null,[o.image&&o.image.length>0?(c(),i("img",{key:0,src:"https://images.kalanso.top/"+o.image[0],class:"small-testimonial-img",alt:""},null,8,O)):(c(),i("img",P))]),t("td",null,[u(_,{target:"_blank",to:{name:"boycott",params:{id:o._id}}},{default:S(()=>[x(l(o.title),1)]),_:2},1032,["to"])]),t("td",null,l(o.login),1),t("td",null,l(o.dateStart),1),t("td",null,[t("div",{class:T(["badge",o.read?"badge-outline-success":"badge-outline-danger"])},l(o.read?"Approuv\xE9":"Suspens"),3)]),t("td",null,[o.read?W("",!0):(c(),i("a",{key:0,href:"#",onClick:v(k=>d.checkWarn(o.warn_id),["prevent"])},H,8,Q))]),t("td",null,[t("a",{href:"#",onClick:v(k=>d.deleteWarn(o._id,o.user_id),["prevent"])},X,8,J)])]))),128))])])])])])}const tt=p(I,[["render",Z],["__scopeId","data-v-14113031"]]);const et={name:"StatCard",props:{icon:String,number:Number,title:String}},st={class:"card bg-dark mb-3"},ot={class:"card-body"},at={class:"row"},nt={class:"col-9"},ct={class:"text-muted font-weight-normal"},it={class:"d-flex align-items-center align-self-start"},rt={class:"mb-0"},lt={class:"col-3"},dt={class:"icon icon-box-success"},_t={class:"material-icons"};function ut(a,e,s,r,n,d){return c(),i("div",st,[t("div",ot,[t("div",at,[t("div",nt,[t("h6",ct,l(s.title),1),t("div",it,[t("h3",rt,l(s.number),1)])]),t("div",lt,[t("div",dt,[t("span",_t,l(s.icon),1)])])])])])}const ht=p(et,[["render",ut],["__scopeId","data-v-8b86aa84"]]),mt={name:"MainContent",components:{TableWarns:tt,StatCard:ht},data(){return{countUsers:0,countBoycotts:0,countComments:0,countFollows:0}},async created(){await this.getCounts()},methods:{async getCounts(){const a=f();try{let e=await fetch("https://boycott-service.onrender.com/api/users"),s=await e.json();e.status==200?this.countUsers=s.totalUsers:a.error(s.message),e=await fetch("https://boycott-service.onrender.com/api/boycott/stat"),s=await e.json(),e.status==200?s.length&&s.forEach(r=>{this.countBoycotts++,this.countComments+=r.comment_count,this.countFollows+=r.likes_count}):a.error(s.message)}catch(e){a.error(e.message)}}}},pt={id:"main","data-aos":"fade","data-aos-delay":"500"},gt={class:"my-4"},bt={class:"row px-4 text-success"},vt={class:"col-xl-3 col-sm-6"},ft={class:"col-xl-3 col-sm-6 grid-margin stretch-card"},yt={class:"col-xl-3 col-sm-6 grid-margin stretch-card"},kt={class:"col-xl-3 col-sm-6 grid-margin stretch-card"},wt={class:"row my-4"},$t={class:"col-12 grid-margin"};function Ct(a,e,s,r,n,d){const _=m("StatCard"),o=m("TableWarns");return c(),i("main",pt,[t("div",gt,[t("div",bt,[t("div",vt,[u(_,{icon:"manage_accounts",number:n.countUsers,title:"Utilisateurs"},null,8,["number"])]),t("div",ft,[u(_,{icon:"event",number:n.countBoycotts,title:"Boycotts"},null,8,["number"])]),t("div",yt,[u(_,{icon:"chat_bubble",number:n.countComments,title:"Commentaires"},null,8,["number"])]),t("div",kt,[u(_,{icon:"supervisor_account",number:n.countFollows,title:"Abonn\xE9s(\xE9es)"},null,8,["number"])])]),t("div",wt,[t("div",$t,[u(o)])])])])}const Wt=p(mt,[["render",Ct]]);export{Wt as default};
