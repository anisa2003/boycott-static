import{_ as v,o as i,f as S,w as g,c as n,a as t,n as m,T as j,r as f,F as C,g as w,q as I,j as u,u as D,e as B,k as A,m as E,t as l,b as y,d as _,l as L,s as T}from"./index.c3f0c5f8.js";import{h as b}from"./moment.9709ab41.js";const N={props:{slide:String,index:Number,currentIndex:Number,slideDirection:String},computed:{dir(){return this.slideDirection}}},V={key:0},U=["src"];function M(o,e,a,k,s,c){return i(),S(j,{name:c.dir},{default:g(()=>[a.index==a.currentIndex?(i(),n("div",V,[t("img",{src:"https://images.kalanso.top/"+a.slide},null,8,U)])):m("",!0)]),_:1},8,["name"])}const O=v(N,[["render",M],["__scopeId","data-v-44664624"]]);const Y={data(){return{currentIndex:0,slideDirection:""}},components:{CarouselSlide:O},props:{slides:Array},computed:{slidesLength(){return this.slides.length}},methods:{next(){this.currentIndex++,this.currentIndex>=this.slidesLength&&(this.currentIndex=0),this.slideDirection="slide-right"},prev(){this.currentIndex--,this.currentIndex<0&&(this.currentIndex=this.slidesLength-1),this.slideDirection="slide-left"},checkSlide(o){if(o.keyCode===39)this.next();else if(o.keyCode===37)this.prev();else return}}};function z(o,e,a,k,s,c){const h=f("CarouselSlide");return i(),n("div",{class:"carousel",onKeydown:e[2]||(e[2]=d=>c.checkSlide(d)),tabindex:"0"},[(i(!0),n(C,null,w(a.slides,(d,p)=>(i(),S(h,{slide:d,key:p,index:p,currentIndex:s.currentIndex,slideDirection:s.slideDirection,class:"carousel-slider"},null,8,["slide","index","currentIndex","slideDirection"]))),128)),t("button",{onClick:e[0]||(e[0]=u((...d)=>c.next&&c.next(...d),["prevent"])),class:"btn btn-next"},[t("i",{class:I(["bi bi-arrow-right-circle-fill",a.slides.length>1?"":"gray"])},null,2)]),t("button",{onClick:e[1]||(e[1]=u((...d)=>c.prev&&c.prev(...d),["prevent"])),class:"btn btn-prev"},[t("i",{class:I(["bi bi-arrow-left-circle-fill",a.slides.length>1?"":"gray"])},null,2)])],32)}const F=v(Y,[["render",z],["__scopeId","data-v-b8b81e49"]]),W={name:"CommentForm",props:{boycottId:String},data(){return{text:""}},methods:{async addComment(){const o=await fetch("https://boycott-service.onrender.com/api/comment?id="+this.boycottId,{method:"POST",headers:{"Content-type":"application/json","x-access-token":localStorage.accessToken},body:JSON.stringify({text:this.text})}),e=await o.json(),a=D();o.status==201?(a.success(e.message),this.text="",this.$emit("commentAdded")):a.error(e.message)}}},q={class:"form-group mt-3"},P=t("div",{class:"text-center"},[t("button",{type:"submit"},"Envoyer")],-1);function J(o,e,a,k,s,c){return i(),n("form",{onSubmit:e[1]||(e[1]=u((...h)=>c.addComment&&c.addComment(...h),["prevent"])),method:"post",role:"form",class:"form mb-4"},[t("div",q,[B(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=h=>s.text=h)},null,512),[[A,s.text]])]),P],32)}const R=v(W,[["render",J]]);const K={name:"BoycottView",components:{CommentForm:R,Carousel:F},data(){return{boycott:{},liked:!1,warned:!1,dateOptions:{year:"numeric",month:"long",day:"numeric"},toast:D()}},computed:{...E(L,["currentUser","accessToken","isAdmin","isModerator","isAuthentificated"])},async created(){await this.getBoycott(),this.currentUser&&(this.liked=this.boycott.likes.some(o=>this.currentUser.id==o._id),this.warned=this.boycott.warns.some(o=>this.currentUser.id==o.userId._id))},methods:{async getBoycott(){try{let o=this.$route.params.id,e=await fetch("https://boycott-service.onrender.com/api/boycott/"+o);this.boycott=await e.json(),e.status==200?await this.setDates():(this.toast.error(this.boycott.message),this.$router.push("/"))}catch(o){this.toast.error(o),this.$router.push("/")}},commentAdded(){this.getBoycott()},async deleteComment(o){try{let e=await fetch("https://boycott-service.onrender.com/api/comment?boycottId="+this.boycott._id+"&commentId="+o,{method:"DELETE",headers:{"Content-type":"application/json",Authorization:"Bearer "+localStorage.accessToken,"x-access-token":localStorage.accessToken}}),a=e.json();e.status==204?(this.getBoycott(),this.toast.success("Votre commentaire a \xE9t\xE9 effac\xE9")):this.toast.error(a.message)}catch(e){this.toast.error(e)}},async toggleLike(o){if(!this.isAuthentificated){this.toast.error("Vous ne pouvez pas joindre ce boycott car vous n'\xEAtes pas connect\xE9.");return}try{const e=await fetch("https://boycott-service.onrender.com/api/like?boycottId="+this.boycott._id,{method:o,headers:{"Content-type":"application/json",Authorization:"Bearer "+localStorage.accessToken,"x-access-token":localStorage.accessToken}}),a=await e.json();e.status==201?(this.getBoycott(),this.liked=!this.liked,this.toast.success(a.message)):this.toast.error(a.message)}catch(e){this.toast.error(e)}},async addWarn(){try{const o=await fetch("https://boycott-service.onrender.com/api/warn?id="+this.boycott._id,{method:"POST",headers:{"Content-type":"application/json",Authorization:"Bearer "+localStorage.accessToken,"x-access-token":localStorage.accessToken},body:JSON.stringify({read:!1})}),e=await o.json();o.status==201?(this.getBoycott(),this.warned=!0,this.toast.success(e.message)):this.toast.error(e.message)}catch(o){this.toast.error(o)}},async removeWarn(){try{const o=await fetch("https://boycott-service.onrender.com/api/warn?boycottId="+this.boycott._id,{method:"DELETE",headers:{"Content-type":"application/json",Authorization:"Bearer "+localStorage.accessToken,"x-access-token":localStorage.accessToken}}),e=await o.json();o.status==201?(this.getBoycott(),this.warned=!1,this.toast.success(e.message)):this.toast.error(e.message)}catch(o){this.toast.error(o)}},async setDates(){let o=new Date(this.boycott.dateStart),e=new Date(this.boycott.dateEnd);this.boycott.dateStart=b(o).isValid()?b(o).format("MM-DD-YYYY"):"Non d\xE9fini",this.boycott.dateEnd=b(e).isValid()?b(e).format("MM-DD-YYYY"):"Non d\xE9fini"}}},G={class:"page-header d-flex align-items-center"},H={class:"container position-relative"},Q={class:"row d-flex justify-content-center"},X={class:"col-lg-6 text-center"},Z={class:"d-flex justify-content-center align-items-center"},$=t("i",{class:"bi bi-exclamation-diamond-fill ps-3 mb-0"},null,-1),tt=[$],et=t("i",{class:"bi bi-exclamation-diamond ps-3 mb-0"},null,-1),st=[et],ot={id:"gallery-single",class:"gallery-single"},it={class:"container"},nt={key:0,class:"text-center mt-4"},rt={class:"row justify-content-between gy-4 mt-4"},ct={class:"col-lg-8"},lt={class:"row"},at={class:"col-lg-6"},dt={class:"container my-4"},ut={class:"section-header"},ht=t("h2",null,"Date du d\xE9but",-1),_t={class:"col-lg-6"},mt={class:"container my-4"},yt={class:"section-header"},pt=t("h2",null,"Date de la fin",-1),bt={class:"portfolio-description"},gt=t("h2",null,"D\xE9tails du boycott",-1),ft={key:0,class:"container my-4"},vt={class:"section-header"},kt=t("h2",null,"Cr\xE9\xE9 par",-1),xt={class:"comments"},Ct=t("i",{class:"bi bi-quote quote-icon-left"},null,-1),wt=t("i",{class:"bi bi-quote quote-icon-right"},null,-1),It={class:"text-end"},St={key:0,class:"position-absolute trash"},Dt=["onClick"],Tt=t("i",{class:"bi bi-trash"},null,-1),jt=[Tt],Bt=["src"],At={key:1,src:T,class:"testimonial-img"},Et=t("h2",null,"Ajouter un commentaire",-1),Lt={class:"col-lg-3"},Nt={class:"portfolio-info"},Vt=t("h3",null,"Product information",-1),Ut=t("strong",null,"Ann\xE9e de cr\xE9ation",-1),Mt=t("strong",null,"Site web du boycott inscrit",-1),Ot={key:0,href:"#"},Yt={key:1},zt=t("strong",null,"Mots cl\xE9s",-1),Ft=["href"],Wt={class:"portfolio-info"},qt={class:"row mb-4"},Pt=["src"],Jt={key:1,src:T,class:"small-testimonial-img m-auto"},Rt={class:"text-center"};function Kt(o,e,a,k,s,c){const h=f("Carousel"),d=f("RouterLink"),p=f("CommentForm");return i(),n("div",null,[t("div",G,[t("div",H,[t("div",Q,[t("div",X,[t("h2",null,l(s.boycott.title),1),t("p",null,l(s.boycott.resume),1),t("div",Z,[s.liked?(i(),n("a",{key:0,href:"#",class:"cta-btn",onClick:e[0]||(e[0]=u(r=>c.toggleLike("DELETE"),["prevent"]))},"Ne plus joindre")):(i(),n("a",{key:1,href:"#",class:"cta-btn",onClick:e[1]||(e[1]=u(r=>c.toggleLike("POST"),["prevent"]))},"Joindre ce boycott")),s.warned?(i(),n("a",{key:2,href:"#",onClick:e[2]||(e[2]=u((...r)=>c.removeWarn&&c.removeWarn(...r),["prevent"])),title:"Signaler ce boycott"},tt)):(i(),n("a",{key:3,href:"#",onClick:e[3]||(e[3]=u((...r)=>c.addWarn&&c.addWarn(...r),["prevent"])),title:"Signaler ce boycott"},st))])])])])]),t("section",ot,[t("div",it,[s.boycott.image&&s.boycott.image.length>0?(i(),n("div",nt,[y(h,{slides:s.boycott.image},null,8,["slides"])])):m("",!0),t("div",rt,[t("div",ct,[t("div",lt,[t("div",at,[t("div",dt,[t("div",ut,[ht,t("p",null,l(s.boycott.dateStart),1)])])]),t("div",_t,[t("div",mt,[t("div",yt,[pt,t("p",null,l(s.boycott.dateEnd),1)])])])]),t("div",bt,[gt,t("p",null,l(s.boycott.description),1)]),s.boycott.userId?(i(),n("div",ft,[t("div",vt,[kt,t("p",null,[y(d,{to:{name:"profileUser",params:{userId:s.boycott.userId._id}}},{default:g(()=>[_(l(s.boycott.userId.login),1)]),_:1},8,["to"])]),t("span",null,"("+l(s.boycott.userId.country)+")",1)])])):m("",!0),t("div",xt,[t("h2",null,"Commentaires ("+l(s.boycott.comments?s.boycott.comments.length:0)+")",1),(i(!0),n(C,null,w(s.boycott.comments,(r,x)=>(i(),n("div",{class:"testimonial-item pb-3 position-relative",key:x},[t("p",null,[Ct,_(" "+l(r.text)+" ",1),wt]),t("p",It,l(new Date(r.createdAt).toLocaleDateString("fr-FR",s.dateOptions)),1),o.currentUser&&o.currentUser.id==r.userId._id?(i(),n("div",St,[t("a",{href:"#",onClick:u(Gt=>c.deleteComment(r._id),["prevent"])},jt,8,Dt)])):m("",!0),t("div",null,[r.userId.photo?(i(),n("img",{key:0,src:"https://images.kalanso.top/"+r.userId.photo,class:"testimonial-img"},null,8,Bt)):(i(),n("img",At)),t("h3",null,[y(d,{to:{name:"profileUser",params:{userId:r.userId._id}}},{default:g(()=>[_(l(r.userId.login),1)]),_:2},1032,["to"])]),t("h4",null,l(r.userId.country)+", "+l(r.userId.city),1)])]))),128)),Et,y(p,{boycottId:this.boycott._id,onCommentAdded:c.commentAdded},null,8,["boycottId","onCommentAdded"])])]),t("div",Lt,[t("div",Nt,[Vt,t("ul",null,[t("li",null,[Ut,_(),t("span",null,l(s.boycott.year?s.boycott.year:"Non d\xE9fini"),1)]),t("li",null,[Mt,_(),s.boycott.site?(i(),n("a",Ot,l(s.boycott.site),1)):(i(),n("p",Yt,"Non d\xE9fini"))]),t("li",null,[zt,_(),t("span",null,l(s.boycott.tags&&s.boycott.tags.length?s.boycott.tags:"Non d\xE9fini"),1)]),t("li",null,[s.boycott.site?(i(),n("a",{key:0,href:s.boycott.site,target:"_blank",class:"btn-visit align-self-start"},"Visitez le site Web",8,Ft)):m("",!0)])])]),t("div",Wt,[t("h3",null,"Membres ("+l(s.boycott.likes?s.boycott.likes.length:0)+")",1),t("div",qt,[(i(!0),n(C,null,w(s.boycott.likes,(r,x)=>(i(),n("div",{class:"col-lg-4",key:x},[r.photo?(i(),n("img",{key:0,src:"https://images.kalanso.top/"+r.photo,class:"small-testimonial-img m-auto"},null,8,Pt)):(i(),n("img",Jt)),t("p",Rt,[y(d,{to:{name:"profileUser",params:{userId:r._id}}},{default:g(()=>[_(l(r.login),1)]),_:2},1032,["to"])])]))),128))]),s.liked?(i(),n("a",{key:0,href:"#",class:"btn-visit align-self-start",onClick:e[4]||(e[4]=u(r=>c.toggleLike("DELETE"),["prevent"]))},"Ne plus joindre")):m("",!0),s.liked?m("",!0):(i(),n("a",{key:1,href:"#",class:"btn-visit align-self-start",onClick:e[5]||(e[5]=u(r=>c.toggleLike("POST"),["prevent"]))},"Joindre ce boycott"))])])])])])])}const Xt=v(K,[["render",Kt]]);export{Xt as default};
