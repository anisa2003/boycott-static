import{_ as v,o as i,f as S,w as g,c as n,a as t,n as u,T as j,r as f,F as C,g as w,q as I,j as h,u as D,e as B,k as A,m as E,t as l,b as y,d as m,l as L,s as T}from"./index.775a2b03.js";import{h as b}from"./moment.9709ab41.js";const N={props:{slide:String,index:Number,currentIndex:Number,slideDirection:String},computed:{dir(){return this.slideDirection}}},V={key:0},U=["src"];function M(o,e,a,k,s,c){return i(),S(j,{name:c.dir},{default:g(()=>[a.index==a.currentIndex?(i(),n("div",V,[t("img",{src:"https://images.kalanso.top/"+a.slide},null,8,U)])):u("",!0)]),_:1},8,["name"])}const O=v(N,[["render",M],["__scopeId","data-v-44664624"]]);const Y={data(){return{currentIndex:0,slideDirection:""}},components:{CarouselSlide:O},props:{slides:Array},computed:{slidesLength(){return this.slides.length}},methods:{next(){this.currentIndex++,this.currentIndex>=this.slidesLength&&(this.currentIndex=0),this.slideDirection="slide-right"},prev(){this.currentIndex--,this.currentIndex<0&&(this.currentIndex=this.slidesLength-1),this.slideDirection="slide-left"},checkSlide(o){if(o.keyCode===39)this.next();else if(o.keyCode===37)this.prev();else return}}};function z(o,e,a,k,s,c){const _=f("CarouselSlide");return i(),n("div",{class:"carousel",onKeydown:e[2]||(e[2]=d=>c.checkSlide(d)),tabindex:"0"},[(i(!0),n(C,null,w(a.slides,(d,p)=>(i(),S(_,{slide:d,key:p,index:p,currentIndex:s.currentIndex,slideDirection:s.slideDirection,class:"carousel-slider"},null,8,["slide","index","currentIndex","slideDirection"]))),128)),t("button",{onClick:e[0]||(e[0]=h((...d)=>c.next&&c.next(...d),["prevent"])),class:"btn btn-next"},[t("i",{class:I(["bi bi-arrow-right-circle-fill",a.slides.length>1?"":"gray"])},null,2)]),t("button",{onClick:e[1]||(e[1]=h((...d)=>c.prev&&c.prev(...d),["prevent"])),class:"btn btn-prev"},[t("i",{class:I(["bi bi-arrow-left-circle-fill",a.slides.length>1?"":"gray"])},null,2)])],32)}const F=v(Y,[["render",z],["__scopeId","data-v-b8b81e49"]]),W={name:"CommentForm",props:{boycottId:String},data(){return{text:""}},methods:{async addComment(){const o=await fetch("https://boycott-service.onrender.com/api/comment?id="+this.boycottId,{method:"POST",headers:{"Content-type":"application/json","x-access-token":localStorage.accessToken},body:JSON.stringify({text:this.text})}),e=await o.json(),a=D();o.status==201?(a.success(e.message),this.text="",this.$emit("commentAdded")):a.error(e.message)}}},q={class:"form-group mt-3"},P=t("div",{class:"text-center"},[t("button",{type:"submit"},"Envoyer")],-1);function J(o,e,a,k,s,c){return i(),n("form",{onSubmit:e[1]||(e[1]=h((..._)=>c.addComment&&c.addComment(..._),["prevent"])),method:"post",role:"form",class:"form mb-4"},[t("div",q,[B(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=_=>s.text=_)},null,512),[[A,s.text]])]),P],32)}const R=v(W,[["render",J]]);const K={name:"BoycottView",components:{CommentForm:R,Carousel:F},data(){return{boycott:{},liked:!1,warned:!1,dateOptions:{year:"numeric",month:"long",day:"numeric"},toast:D()}},computed:{...E(L,["currentUser","accessToken","isAdmin","isModerator","isAuthentificated"])},async created(){await this.getBoycott(),this.currentUser&&(this.liked=this.boycott.likes.some(o=>this.currentUser.id==o._id),this.warned=this.boycott.warns.some(o=>this.currentUser.id==o.userId._id))},methods:{async getBoycott(){try{let o=this.$route.params.id,e=await fetch("https://boycott-service.onrender.com/api/boycott/"+o);this.boycott=await e.json(),e.status==200?await this.setDates():(this.toast.error(this.boycott.message),this.$router.push("/"))}catch(o){this.toast.error(o),this.$router.push("/")}},commentAdded(){this.getBoycott()},async deleteComment(o){try{let e=await fetch("https://boycott-service.onrender.com/api/comment?boycottId="+this.boycott._id+"&commentId="+o,{method:"DELETE",headers:{"Content-type":"application/json",Authorization:"Bearer "+localStorage.accessToken,"x-access-token":localStorage.accessToken}}),a=e.json();e.status==204?(this.getBoycott(),this.toast.success("Votre commentaire a \xE9t\xE9 effac\xE9")):this.toast.error(a.message)}catch(e){this.toast.error(e)}},async toggleLike(o){if(!this.isAuthentificated){this.toast.error("Vous ne pouvez pas joindre ce boycott car vous n'\xEAtes pas connect\xE9.");return}try{const e=await fetch("https://boycott-service.onrender.com/api/like?boycottId="+this.boycott._id,{method:o,headers:{"Content-type":"application/json",Authorization:"Bearer "+localStorage.accessToken,"x-access-token":localStorage.accessToken}}),a=await e.json();e.status==201?(this.getBoycott(),this.liked=!this.liked,this.toast.success(a.message)):this.toast.error(a.message)}catch(e){this.toast.error(e)}},async addWarn(){try{const o=await fetch("https://boycott-service.onrender.com/api/warn?id="+this.boycott._id,{method:"POST",headers:{"Content-type":"application/json",Authorization:"Bearer "+localStorage.accessToken,"x-access-token":localStorage.accessToken},body:JSON.stringify({read:!1})}),e=await o.json();o.status==201?(this.getBoycott(),this.warned=!0,this.toast.success(e.message)):this.toast.error(e.message)}catch(o){this.toast.error(o)}},async removeWarn(){try{const o=await fetch("https://boycott-service.onrender.com/api/warn?boycottId="+this.boycott._id,{method:"DELETE",headers:{"Content-type":"application/json",Authorization:"Bearer "+localStorage.accessToken,"x-access-token":localStorage.accessToken}}),e=await o.json();o.status==201?(this.getBoycott(),this.warned=!1,this.toast.success(e.message)):this.toast.error(e.message)}catch(o){this.toast.error(o)}},async setDates(){let o=new Date(this.boycott.dateStart),e=new Date(this.boycott.dateEnd);this.boycott.dateStart=b(o).isValid()?b(o).format("MM-DD-YYYY"):"Non d\xE9fini",this.boycott.dateEnd=b(e).isValid()?b(e).format("MM-DD-YYYY"):"Non d\xE9fini"}}},G={class:"page-header d-flex align-items-center"},H={class:"container position-relative"},Q={class:"row d-flex justify-content-center"},X={class:"col-lg-6 text-center"},Z=t("i",{class:"bi bi-exclamation-diamond-fill ps-3 mb-0"},null,-1),$=[Z],tt=t("i",{class:"bi bi-exclamation-diamond ps-3 mb-0"},null,-1),et=[tt],st={id:"gallery-single",class:"gallery-single"},ot={class:"container"},it={key:0,class:"text-center mt-4"},nt={class:"row justify-content-between gy-4 mt-4"},rt={class:"col-lg-8"},ct={class:"row"},lt={class:"col-lg-6"},at={class:"container my-4"},dt={class:"section-header"},ut=t("h2",null,"Date du d\xE9but",-1),ht={class:"col-lg-6"},_t={class:"container my-4"},mt={class:"section-header"},yt=t("h2",null,"Date de la fin",-1),pt={class:"portfolio-description"},bt=t("h2",null,"D\xE9tails du boycott",-1),gt={key:0,class:"container my-4"},ft={class:"section-header"},vt=t("h2",null,"Cr\xE9\xE9 par",-1),kt={class:"comments"},xt=t("i",{class:"bi bi-quote quote-icon-left"},null,-1),Ct=t("i",{class:"bi bi-quote quote-icon-right"},null,-1),wt={class:"text-end"},It={key:0,class:"position-absolute trash"},St=["onClick"],Dt=t("i",{class:"bi bi-trash"},null,-1),Tt=[Dt],jt=["src"],Bt={key:1,src:T,class:"testimonial-img"},At=t("h2",null,"Ajouter un commentaire",-1),Et={class:"col-lg-3"},Lt={class:"portfolio-info"},Nt=t("h3",null,"Product information",-1),Vt=t("strong",null,"Ann\xE9e de cr\xE9ation",-1),Ut=t("strong",null,"Site web du boycott inscrit",-1),Mt={key:0,href:"#"},Ot={key:1},Yt=t("strong",null,"Mots cl\xE9s",-1),zt=["href"],Ft={class:"portfolio-info"},Wt={class:"row mb-4"},qt=["src"],Pt={key:1,src:T,class:"small-testimonial-img m-auto"},Jt={class:"text-center"};function Rt(o,e,a,k,s,c){const _=f("Carousel"),d=f("RouterLink"),p=f("CommentForm");return i(),n("div",null,[t("div",G,[t("div",H,[t("div",Q,[t("div",X,[t("h2",null,l(s.boycott.title),1),t("p",null,l(s.boycott.resume),1),s.liked?(i(),n("a",{key:0,href:"#",class:"cta-btn",onClick:e[0]||(e[0]=h(r=>c.toggleLike("DELETE"),["prevent"]))},"Ne plus joindre")):u("",!0),s.liked?u("",!0):(i(),n("a",{key:1,href:"#",class:"cta-btn",onClick:e[1]||(e[1]=h(r=>c.toggleLike("POST"),["prevent"]))},"Joindre ce boycott")),s.warned?(i(),n("a",{key:2,href:"#",onClick:e[2]||(e[2]=h((...r)=>c.removeWarn&&c.removeWarn(...r),["prevent"]))},$)):u("",!0),s.warned?u("",!0):(i(),n("a",{key:3,href:"#",onClick:e[3]||(e[3]=h((...r)=>c.addWarn&&c.addWarn(...r),["prevent"]))},et))])])])]),t("section",st,[t("div",ot,[s.boycott.image&&s.boycott.image.length>0?(i(),n("div",it,[y(_,{slides:s.boycott.image},null,8,["slides"])])):u("",!0),t("div",nt,[t("div",rt,[t("div",ct,[t("div",lt,[t("div",at,[t("div",dt,[ut,t("p",null,l(s.boycott.dateStart),1)])])]),t("div",ht,[t("div",_t,[t("div",mt,[yt,t("p",null,l(s.boycott.dateEnd),1)])])])]),t("div",pt,[bt,t("p",null,l(s.boycott.description),1)]),s.boycott.userId?(i(),n("div",gt,[t("div",ft,[vt,t("p",null,[y(d,{to:{name:"profileUser",params:{userId:s.boycott.userId._id}}},{default:g(()=>[m(l(s.boycott.userId.login),1)]),_:1},8,["to"])]),t("span",null,"("+l(s.boycott.userId.country)+")",1)])])):u("",!0),t("div",kt,[t("h2",null,"Commentaires ("+l(s.boycott.comments?s.boycott.comments.length:0)+")",1),(i(!0),n(C,null,w(s.boycott.comments,(r,x)=>(i(),n("div",{class:"testimonial-item pb-3 position-relative",key:x},[t("p",null,[xt,m(" "+l(r.text)+" ",1),Ct]),t("p",wt,l(new Date(r.createdAt).toLocaleDateString("fr-FR",s.dateOptions)),1),o.currentUser&&o.currentUser.id==r.userId._id?(i(),n("div",It,[t("a",{href:"#",onClick:h(Kt=>c.deleteComment(r._id),["prevent"])},Tt,8,St)])):u("",!0),t("div",null,[r.userId.photo?(i(),n("img",{key:0,src:"https://images.kalanso.top/"+r.userId.photo,class:"testimonial-img"},null,8,jt)):(i(),n("img",Bt)),t("h3",null,[y(d,{to:{name:"profileUser",params:{userId:r.userId._id}}},{default:g(()=>[m(l(r.userId.login),1)]),_:2},1032,["to"])]),t("h4",null,l(r.userId.country)+", "+l(r.userId.city),1)])]))),128)),At,y(p,{boycottId:this.boycott._id,onCommentAdded:c.commentAdded},null,8,["boycottId","onCommentAdded"])])]),t("div",Et,[t("div",Lt,[Nt,t("ul",null,[t("li",null,[Vt,m(),t("span",null,l(s.boycott.year?s.boycott.year:"Non d\xE9fini"),1)]),t("li",null,[Ut,m(),s.boycott.site?(i(),n("a",Mt,l(s.boycott.site),1)):(i(),n("p",Ot,"Non d\xE9fini"))]),t("li",null,[Yt,m(),t("span",null,l(s.boycott.tags&&s.boycott.tags.length?s.boycott.tags:"Non d\xE9fini"),1)]),t("li",null,[s.boycott.site?(i(),n("a",{key:0,href:s.boycott.site,target:"_blank",class:"btn-visit align-self-start"},"Visitez le site Web",8,zt)):u("",!0)])])]),t("div",Ft,[t("h3",null,"Membres ("+l(s.boycott.likes?s.boycott.likes.length:0)+")",1),t("div",Wt,[(i(!0),n(C,null,w(s.boycott.likes,(r,x)=>(i(),n("div",{class:"col-lg-4",key:x},[r.photo?(i(),n("img",{key:0,src:"https://images.kalanso.top/"+r.photo,class:"small-testimonial-img m-auto"},null,8,qt)):(i(),n("img",Pt)),t("p",Jt,[y(d,{to:{name:"profileUser",params:{userId:r._id}}},{default:g(()=>[m(l(r.login),1)]),_:2},1032,["to"])])]))),128))]),s.liked?(i(),n("a",{key:0,href:"#",class:"btn-visit align-self-start",onClick:e[4]||(e[4]=h(r=>c.toggleLike("DELETE"),["prevent"]))},"Ne plus joindre")):u("",!0),s.liked?u("",!0):(i(),n("a",{key:1,href:"#",class:"btn-visit align-self-start",onClick:e[5]||(e[5]=h(r=>c.toggleLike("POST"),["prevent"]))},"Joindre ce boycott"))])])])])])])}const Qt=v(K,[["render",Rt]]);export{Qt as default};
